{"ast":null,"code":"import { SEC_TO_RAD } from '../constants/values';\n/*\n  reference\n    Department of Land and Survey Technical Circular 1973/32\n      http://www.linz.govt.nz/docs/miscellaneous/nz-map-definition.pdf\n    OSG Technical Report 4.1\n      http://www.linz.govt.nz/docs/miscellaneous/nzmg.pdf\n  */\n\n/**\n * iterations: Number of iterations to refine inverse transform.\n *     0 -> km accuracy\n *     1 -> m accuracy -- suitable for most mapping applications\n *     2 -> mm accuracy\n */\n\nexport var iterations = 1;\nexport function init() {\n  this.A = [];\n  this.A[1] = 0.6399175073;\n  this.A[2] = -0.1358797613;\n  this.A[3] = 0.063294409;\n  this.A[4] = -0.02526853;\n  this.A[5] = 0.0117879;\n  this.A[6] = -0.0055161;\n  this.A[7] = 0.0026906;\n  this.A[8] = -0.001333;\n  this.A[9] = 0.00067;\n  this.A[10] = -0.00034;\n  this.B_re = [];\n  this.B_im = [];\n  this.B_re[1] = 0.7557853228;\n  this.B_im[1] = 0;\n  this.B_re[2] = 0.249204646;\n  this.B_im[2] = 0.003371507;\n  this.B_re[3] = -0.001541739;\n  this.B_im[3] = 0.041058560;\n  this.B_re[4] = -0.10162907;\n  this.B_im[4] = 0.01727609;\n  this.B_re[5] = -0.26623489;\n  this.B_im[5] = -0.36249218;\n  this.B_re[6] = -0.6870983;\n  this.B_im[6] = -1.1651967;\n  this.C_re = [];\n  this.C_im = [];\n  this.C_re[1] = 1.3231270439;\n  this.C_im[1] = 0;\n  this.C_re[2] = -0.577245789;\n  this.C_im[2] = -0.007809598;\n  this.C_re[3] = 0.508307513;\n  this.C_im[3] = -0.112208952;\n  this.C_re[4] = -0.15094762;\n  this.C_im[4] = 0.18200602;\n  this.C_re[5] = 1.01418179;\n  this.C_im[5] = 1.64497696;\n  this.C_re[6] = 1.9660549;\n  this.C_im[6] = 2.5127645;\n  this.D = [];\n  this.D[1] = 1.5627014243;\n  this.D[2] = 0.5185406398;\n  this.D[3] = -0.03333098;\n  this.D[4] = -0.1052906;\n  this.D[5] = -0.0368594;\n  this.D[6] = 0.007317;\n  this.D[7] = 0.01220;\n  this.D[8] = 0.00394;\n  this.D[9] = -0.0013;\n}\n/**\n    New Zealand Map Grid Forward  - long/lat to x/y\n    long/lat in radians\n  */\n\nexport function forward(p) {\n  var n;\n  var lon = p.x;\n  var lat = p.y;\n  var delta_lat = lat - this.lat0;\n  var delta_lon = lon - this.long0; // 1. Calculate d_phi and d_psi    ...                          // and d_lambda\n  // For this algorithm, delta_latitude is in seconds of arc x 10-5, so we need to scale to those units. Longitude is radians.\n\n  var d_phi = delta_lat / SEC_TO_RAD * 1E-5;\n  var d_lambda = delta_lon;\n  var d_phi_n = 1; // d_phi^0\n\n  var d_psi = 0;\n\n  for (n = 1; n <= 10; n++) {\n    d_phi_n = d_phi_n * d_phi;\n    d_psi = d_psi + this.A[n] * d_phi_n;\n  } // 2. Calculate theta\n\n\n  var th_re = d_psi;\n  var th_im = d_lambda; // 3. Calculate z\n\n  var th_n_re = 1;\n  var th_n_im = 0; // theta^0\n\n  var th_n_re1;\n  var th_n_im1;\n  var z_re = 0;\n  var z_im = 0;\n\n  for (n = 1; n <= 6; n++) {\n    th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n    th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n    th_n_re = th_n_re1;\n    th_n_im = th_n_im1;\n    z_re = z_re + this.B_re[n] * th_n_re - this.B_im[n] * th_n_im;\n    z_im = z_im + this.B_im[n] * th_n_re + this.B_re[n] * th_n_im;\n  } // 4. Calculate easting and northing\n\n\n  p.x = z_im * this.a + this.x0;\n  p.y = z_re * this.a + this.y0;\n  return p;\n}\n/**\n    New Zealand Map Grid Inverse  -  x/y to long/lat\n  */\n\nexport function inverse(p) {\n  var n;\n  var x = p.x;\n  var y = p.y;\n  var delta_x = x - this.x0;\n  var delta_y = y - this.y0; // 1. Calculate z\n\n  var z_re = delta_y / this.a;\n  var z_im = delta_x / this.a; // 2a. Calculate theta - first approximation gives km accuracy\n\n  var z_n_re = 1;\n  var z_n_im = 0; // z^0\n\n  var z_n_re1;\n  var z_n_im1;\n  var th_re = 0;\n  var th_im = 0;\n\n  for (n = 1; n <= 6; n++) {\n    z_n_re1 = z_n_re * z_re - z_n_im * z_im;\n    z_n_im1 = z_n_im * z_re + z_n_re * z_im;\n    z_n_re = z_n_re1;\n    z_n_im = z_n_im1;\n    th_re = th_re + this.C_re[n] * z_n_re - this.C_im[n] * z_n_im;\n    th_im = th_im + this.C_im[n] * z_n_re + this.C_re[n] * z_n_im;\n  } // 2b. Iterate to refine the accuracy of the calculation\n  //        0 iterations gives km accuracy\n  //        1 iteration gives m accuracy -- good enough for most mapping applications\n  //        2 iterations bives mm accuracy\n\n\n  for (var i = 0; i < this.iterations; i++) {\n    var th_n_re = th_re;\n    var th_n_im = th_im;\n    var th_n_re1;\n    var th_n_im1;\n    var num_re = z_re;\n    var num_im = z_im;\n\n    for (n = 2; n <= 6; n++) {\n      th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n      th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n      th_n_re = th_n_re1;\n      th_n_im = th_n_im1;\n      num_re = num_re + (n - 1) * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);\n      num_im = num_im + (n - 1) * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);\n    }\n\n    th_n_re = 1;\n    th_n_im = 0;\n    var den_re = this.B_re[1];\n    var den_im = this.B_im[1];\n\n    for (n = 2; n <= 6; n++) {\n      th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n      th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n      th_n_re = th_n_re1;\n      th_n_im = th_n_im1;\n      den_re = den_re + n * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);\n      den_im = den_im + n * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);\n    } // Complex division\n\n\n    var den2 = den_re * den_re + den_im * den_im;\n    th_re = (num_re * den_re + num_im * den_im) / den2;\n    th_im = (num_im * den_re - num_re * den_im) / den2;\n  } // 3. Calculate d_phi              ...                                    // and d_lambda\n\n\n  var d_psi = th_re;\n  var d_lambda = th_im;\n  var d_psi_n = 1; // d_psi^0\n\n  var d_phi = 0;\n\n  for (n = 1; n <= 9; n++) {\n    d_psi_n = d_psi_n * d_psi;\n    d_phi = d_phi + this.D[n] * d_psi_n;\n  } // 4. Calculate latitude and longitude\n  // d_phi is calcuated in second of arc * 10^-5, so we need to scale back to radians. d_lambda is in radians.\n\n\n  var lat = this.lat0 + d_phi * SEC_TO_RAD * 1E5;\n  var lon = this.long0 + d_lambda;\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\nexport var names = [\"New_Zealand_Map_Grid\", \"nzmg\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};","map":{"version":3,"sources":["C:/Users/brand/source/repos/DAS-Server/client/node_modules/proj4/lib/projections/nzmg.js"],"names":["SEC_TO_RAD","iterations","init","A","B_re","B_im","C_re","C_im","D","forward","p","n","lon","x","lat","y","delta_lat","lat0","delta_lon","long0","d_phi","d_lambda","d_phi_n","d_psi","th_re","th_im","th_n_re","th_n_im","th_n_re1","th_n_im1","z_re","z_im","a","x0","y0","inverse","delta_x","delta_y","z_n_re","z_n_im","z_n_re1","z_n_im1","i","num_re","num_im","den_re","den_im","den2","d_psi_n","names"],"mappings":"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","sourcesContent":["import {SEC_TO_RAD} from '../constants/values';\n\n/*\n  reference\n    Department of Land and Survey Technical Circular 1973/32\n      http://www.linz.govt.nz/docs/miscellaneous/nz-map-definition.pdf\n    OSG Technical Report 4.1\n      http://www.linz.govt.nz/docs/miscellaneous/nzmg.pdf\n  */\n\n/**\n * iterations: Number of iterations to refine inverse transform.\n *     0 -> km accuracy\n *     1 -> m accuracy -- suitable for most mapping applications\n *     2 -> mm accuracy\n */\nexport var iterations = 1;\n\nexport function init() {\n  this.A = [];\n  this.A[1] = 0.6399175073;\n  this.A[2] = -0.1358797613;\n  this.A[3] = 0.063294409;\n  this.A[4] = -0.02526853;\n  this.A[5] = 0.0117879;\n  this.A[6] = -0.0055161;\n  this.A[7] = 0.0026906;\n  this.A[8] = -0.001333;\n  this.A[9] = 0.00067;\n  this.A[10] = -0.00034;\n\n  this.B_re = [];\n  this.B_im = [];\n  this.B_re[1] = 0.7557853228;\n  this.B_im[1] = 0;\n  this.B_re[2] = 0.249204646;\n  this.B_im[2] = 0.003371507;\n  this.B_re[3] = -0.001541739;\n  this.B_im[3] = 0.041058560;\n  this.B_re[4] = -0.10162907;\n  this.B_im[4] = 0.01727609;\n  this.B_re[5] = -0.26623489;\n  this.B_im[5] = -0.36249218;\n  this.B_re[6] = -0.6870983;\n  this.B_im[6] = -1.1651967;\n\n  this.C_re = [];\n  this.C_im = [];\n  this.C_re[1] = 1.3231270439;\n  this.C_im[1] = 0;\n  this.C_re[2] = -0.577245789;\n  this.C_im[2] = -0.007809598;\n  this.C_re[3] = 0.508307513;\n  this.C_im[3] = -0.112208952;\n  this.C_re[4] = -0.15094762;\n  this.C_im[4] = 0.18200602;\n  this.C_re[5] = 1.01418179;\n  this.C_im[5] = 1.64497696;\n  this.C_re[6] = 1.9660549;\n  this.C_im[6] = 2.5127645;\n\n  this.D = [];\n  this.D[1] = 1.5627014243;\n  this.D[2] = 0.5185406398;\n  this.D[3] = -0.03333098;\n  this.D[4] = -0.1052906;\n  this.D[5] = -0.0368594;\n  this.D[6] = 0.007317;\n  this.D[7] = 0.01220;\n  this.D[8] = 0.00394;\n  this.D[9] = -0.0013;\n}\n\n/**\n    New Zealand Map Grid Forward  - long/lat to x/y\n    long/lat in radians\n  */\nexport function forward(p) {\n  var n;\n  var lon = p.x;\n  var lat = p.y;\n\n  var delta_lat = lat - this.lat0;\n  var delta_lon = lon - this.long0;\n\n  // 1. Calculate d_phi and d_psi    ...                          // and d_lambda\n  // For this algorithm, delta_latitude is in seconds of arc x 10-5, so we need to scale to those units. Longitude is radians.\n  var d_phi = delta_lat / SEC_TO_RAD * 1E-5;\n  var d_lambda = delta_lon;\n  var d_phi_n = 1; // d_phi^0\n\n  var d_psi = 0;\n  for (n = 1; n <= 10; n++) {\n    d_phi_n = d_phi_n * d_phi;\n    d_psi = d_psi + this.A[n] * d_phi_n;\n  }\n\n  // 2. Calculate theta\n  var th_re = d_psi;\n  var th_im = d_lambda;\n\n  // 3. Calculate z\n  var th_n_re = 1;\n  var th_n_im = 0; // theta^0\n  var th_n_re1;\n  var th_n_im1;\n\n  var z_re = 0;\n  var z_im = 0;\n  for (n = 1; n <= 6; n++) {\n    th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n    th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n    th_n_re = th_n_re1;\n    th_n_im = th_n_im1;\n    z_re = z_re + this.B_re[n] * th_n_re - this.B_im[n] * th_n_im;\n    z_im = z_im + this.B_im[n] * th_n_re + this.B_re[n] * th_n_im;\n  }\n\n  // 4. Calculate easting and northing\n  p.x = (z_im * this.a) + this.x0;\n  p.y = (z_re * this.a) + this.y0;\n\n  return p;\n}\n\n/**\n    New Zealand Map Grid Inverse  -  x/y to long/lat\n  */\nexport function inverse(p) {\n  var n;\n  var x = p.x;\n  var y = p.y;\n\n  var delta_x = x - this.x0;\n  var delta_y = y - this.y0;\n\n  // 1. Calculate z\n  var z_re = delta_y / this.a;\n  var z_im = delta_x / this.a;\n\n  // 2a. Calculate theta - first approximation gives km accuracy\n  var z_n_re = 1;\n  var z_n_im = 0; // z^0\n  var z_n_re1;\n  var z_n_im1;\n\n  var th_re = 0;\n  var th_im = 0;\n  for (n = 1; n <= 6; n++) {\n    z_n_re1 = z_n_re * z_re - z_n_im * z_im;\n    z_n_im1 = z_n_im * z_re + z_n_re * z_im;\n    z_n_re = z_n_re1;\n    z_n_im = z_n_im1;\n    th_re = th_re + this.C_re[n] * z_n_re - this.C_im[n] * z_n_im;\n    th_im = th_im + this.C_im[n] * z_n_re + this.C_re[n] * z_n_im;\n  }\n\n  // 2b. Iterate to refine the accuracy of the calculation\n  //        0 iterations gives km accuracy\n  //        1 iteration gives m accuracy -- good enough for most mapping applications\n  //        2 iterations bives mm accuracy\n  for (var i = 0; i < this.iterations; i++) {\n    var th_n_re = th_re;\n    var th_n_im = th_im;\n    var th_n_re1;\n    var th_n_im1;\n\n    var num_re = z_re;\n    var num_im = z_im;\n    for (n = 2; n <= 6; n++) {\n      th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n      th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n      th_n_re = th_n_re1;\n      th_n_im = th_n_im1;\n      num_re = num_re + (n - 1) * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);\n      num_im = num_im + (n - 1) * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);\n    }\n\n    th_n_re = 1;\n    th_n_im = 0;\n    var den_re = this.B_re[1];\n    var den_im = this.B_im[1];\n    for (n = 2; n <= 6; n++) {\n      th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n      th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n      th_n_re = th_n_re1;\n      th_n_im = th_n_im1;\n      den_re = den_re + n * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);\n      den_im = den_im + n * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);\n    }\n\n    // Complex division\n    var den2 = den_re * den_re + den_im * den_im;\n    th_re = (num_re * den_re + num_im * den_im) / den2;\n    th_im = (num_im * den_re - num_re * den_im) / den2;\n  }\n\n  // 3. Calculate d_phi              ...                                    // and d_lambda\n  var d_psi = th_re;\n  var d_lambda = th_im;\n  var d_psi_n = 1; // d_psi^0\n\n  var d_phi = 0;\n  for (n = 1; n <= 9; n++) {\n    d_psi_n = d_psi_n * d_psi;\n    d_phi = d_phi + this.D[n] * d_psi_n;\n  }\n\n  // 4. Calculate latitude and longitude\n  // d_phi is calcuated in second of arc * 10^-5, so we need to scale back to radians. d_lambda is in radians.\n  var lat = this.lat0 + (d_phi * SEC_TO_RAD * 1E5);\n  var lon = this.long0 + d_lambda;\n\n  p.x = lon;\n  p.y = lat;\n\n  return p;\n}\n\nexport var names = [\"New_Zealand_Map_Grid\", \"nzmg\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n"]},"metadata":{},"sourceType":"module"}