{"ast":null,"code":"var mode = {\n  N_POLE: 0,\n  S_POLE: 1,\n  EQUIT: 2,\n  OBLIQ: 3\n};\nimport { D2R, HALF_PI, EPSLN } from \"../constants/values\";\nimport hypot from \"../common/hypot\";\nvar params = {\n  h: {\n    def: 100000,\n    num: true\n  },\n  // default is Karman line, no default in PROJ.7\n  azi: {\n    def: 0,\n    num: true,\n    degrees: true\n  },\n  // default is North\n  tilt: {\n    def: 0,\n    num: true,\n    degrees: true\n  },\n  // default is Nadir\n  long0: {\n    def: 0,\n    num: true\n  },\n  // default is Greenwich, conversion to rad is automatic\n  lat0: {\n    def: 0,\n    num: true\n  } // default is Equator, conversion to rad is automatic\n\n};\nexport function init() {\n  Object.keys(params).forEach(function (p) {\n    if (typeof this[p] === \"undefined\") {\n      this[p] = params[p].def;\n    } else if (params[p].num && isNaN(this[p])) {\n      throw new Error(\"Invalid parameter value, must be numeric \" + p + \" = \" + this[p]);\n    } else if (params[p].num) {\n      this[p] = parseFloat(this[p]);\n    }\n\n    if (params[p].degrees) {\n      this[p] = this[p] * D2R;\n    }\n  }.bind(this));\n\n  if (Math.abs(Math.abs(this.lat0) - HALF_PI) < EPSLN) {\n    this.mode = this.lat0 < 0 ? mode.S_POLE : mode.N_POLE;\n  } else if (Math.abs(this.lat0) < EPSLN) {\n    this.mode = mode.EQUIT;\n  } else {\n    this.mode = mode.OBLIQ;\n    this.sinph0 = Math.sin(this.lat0);\n    this.cosph0 = Math.cos(this.lat0);\n  }\n\n  this.pn1 = this.h / this.a; // Normalize relative to the Earth's radius\n\n  if (this.pn1 <= 0 || this.pn1 > 1e10) {\n    throw new Error(\"Invalid height\");\n  }\n\n  this.p = 1 + this.pn1;\n  this.rp = 1 / this.p;\n  this.h1 = 1 / this.pn1;\n  this.pfact = (this.p + 1) * this.h1;\n  this.es = 0;\n  var omega = this.tilt;\n  var gamma = this.azi;\n  this.cg = Math.cos(gamma);\n  this.sg = Math.sin(gamma);\n  this.cw = Math.cos(omega);\n  this.sw = Math.sin(omega);\n}\nexport function forward(p) {\n  p.x -= this.long0;\n  var sinphi = Math.sin(p.y);\n  var cosphi = Math.cos(p.y);\n  var coslam = Math.cos(p.x);\n  var x, y;\n\n  switch (this.mode) {\n    case mode.OBLIQ:\n      y = this.sinph0 * sinphi + this.cosph0 * cosphi * coslam;\n      break;\n\n    case mode.EQUIT:\n      y = cosphi * coslam;\n      break;\n\n    case mode.S_POLE:\n      y = -sinphi;\n      break;\n\n    case mode.N_POLE:\n      y = sinphi;\n      break;\n  }\n\n  y = this.pn1 / (this.p - y);\n  x = y * cosphi * Math.sin(p.x);\n\n  switch (this.mode) {\n    case mode.OBLIQ:\n      y *= this.cosph0 * sinphi - this.sinph0 * cosphi * coslam;\n      break;\n\n    case mode.EQUIT:\n      y *= sinphi;\n      break;\n\n    case mode.N_POLE:\n      y *= -(cosphi * coslam);\n      break;\n\n    case mode.S_POLE:\n      y *= cosphi * coslam;\n      break;\n  } // Tilt \n\n\n  var yt, ba;\n  yt = y * this.cg + x * this.sg;\n  ba = 1 / (yt * this.sw * this.h1 + this.cw);\n  x = (x * this.cg - y * this.sg) * this.cw * ba;\n  y = yt * ba;\n  p.x = x * this.a;\n  p.y = y * this.a;\n  return p;\n}\nexport function inverse(p) {\n  p.x /= this.a;\n  p.y /= this.a;\n  var r = {\n    x: p.x,\n    y: p.y\n  }; // Un-Tilt\n\n  var bm, bq, yt;\n  yt = 1 / (this.pn1 - p.y * this.sw);\n  bm = this.pn1 * p.x * yt;\n  bq = this.pn1 * p.y * this.cw * yt;\n  p.x = bm * this.cg + bq * this.sg;\n  p.y = bq * this.cg - bm * this.sg;\n  var rh = hypot(p.x, p.y);\n\n  if (Math.abs(rh) < EPSLN) {\n    r.x = 0;\n    r.y = p.y;\n  } else {\n    var cosz, sinz;\n    sinz = 1 - rh * rh * this.pfact;\n    sinz = (this.p - Math.sqrt(sinz)) / (this.pn1 / rh + rh / this.pn1);\n    cosz = Math.sqrt(1 - sinz * sinz);\n\n    switch (this.mode) {\n      case mode.OBLIQ:\n        r.y = Math.asin(cosz * this.sinph0 + p.y * sinz * this.cosph0 / rh);\n        p.y = (cosz - this.sinph0 * Math.sin(r.y)) * rh;\n        p.x *= sinz * this.cosph0;\n        break;\n\n      case mode.EQUIT:\n        r.y = Math.asin(p.y * sinz / rh);\n        p.y = cosz * rh;\n        p.x *= sinz;\n        break;\n\n      case mode.N_POLE:\n        r.y = Math.asin(cosz);\n        p.y = -p.y;\n        break;\n\n      case mode.S_POLE:\n        r.y = -Math.asin(cosz);\n        break;\n    }\n\n    r.x = Math.atan2(p.x, p.y);\n  }\n\n  p.x = r.x + this.long0;\n  p.y = r.y;\n  return p;\n}\nexport var names = [\"Tilted_Perspective\", \"tpers\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};","map":{"version":3,"sources":["C:/Users/brand/source/repos/das-server/client/node_modules/proj4/lib/projections/tpers.js"],"names":["mode","N_POLE","S_POLE","EQUIT","OBLIQ","D2R","HALF_PI","EPSLN","hypot","params","h","def","num","azi","degrees","tilt","long0","lat0","init","Object","keys","forEach","p","isNaN","Error","parseFloat","bind","Math","abs","sinph0","sin","cosph0","cos","pn1","a","rp","h1","pfact","es","omega","gamma","cg","sg","cw","sw","forward","x","sinphi","y","cosphi","coslam","yt","ba","inverse","r","bm","bq","rh","cosz","sinz","sqrt","asin","atan2","names"],"mappings":"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","sourcesContent":["\nvar mode = {\n  N_POLE: 0,\n  S_POLE: 1,\n  EQUIT: 2,\n  OBLIQ: 3\n};\n\nimport { D2R, HALF_PI, EPSLN } from \"../constants/values\";\nimport hypot from \"../common/hypot\";\n\nvar params = {\n  h:     { def: 100000, num: true },           // default is Karman line, no default in PROJ.7\n  azi:   { def: 0, num: true, degrees: true }, // default is North\n  tilt:  { def: 0, num: true, degrees: true }, // default is Nadir\n  long0: { def: 0, num: true },                // default is Greenwich, conversion to rad is automatic\n  lat0:  { def: 0, num: true }                 // default is Equator, conversion to rad is automatic\n};\n\nexport function init() {\n  Object.keys(params).forEach(function (p) {\n    if (typeof this[p] === \"undefined\") {\n      this[p] = params[p].def;\n    } else if (params[p].num && isNaN(this[p])) {\n      throw new Error(\"Invalid parameter value, must be numeric \" + p + \" = \" + this[p]);\n    } else if (params[p].num) {\n      this[p] = parseFloat(this[p]);\n    }\n    if (params[p].degrees) {\n      this[p] = this[p] * D2R;\n    }\n  }.bind(this));\n\n  if (Math.abs((Math.abs(this.lat0) - HALF_PI)) < EPSLN) {\n    this.mode = this.lat0 < 0 ? mode.S_POLE : mode.N_POLE;\n  } else if (Math.abs(this.lat0) < EPSLN) {\n    this.mode = mode.EQUIT;\n  } else {\n    this.mode = mode.OBLIQ;\n    this.sinph0 = Math.sin(this.lat0);\n    this.cosph0 = Math.cos(this.lat0);\n  }\n\n  this.pn1 = this.h / this.a;  // Normalize relative to the Earth's radius\n\n  if (this.pn1 <= 0 || this.pn1 > 1e10) {\n    throw new Error(\"Invalid height\");\n  }\n  \n  this.p = 1 + this.pn1;\n  this.rp = 1 / this.p;\n  this.h1 = 1 / this.pn1;\n  this.pfact = (this.p + 1) * this.h1;\n  this.es = 0;\n\n  var omega = this.tilt;\n  var gamma = this.azi;\n  this.cg = Math.cos(gamma);\n  this.sg = Math.sin(gamma);\n  this.cw = Math.cos(omega);\n  this.sw = Math.sin(omega);\n}\n\nexport function forward(p) {\n  p.x -= this.long0;\n  var sinphi = Math.sin(p.y);\n  var cosphi = Math.cos(p.y);\n  var coslam = Math.cos(p.x);\n  var x, y;\n  switch (this.mode) {\n    case mode.OBLIQ:\n      y = this.sinph0 * sinphi + this.cosph0 * cosphi * coslam;\n      break;\n    case mode.EQUIT:\n      y = cosphi * coslam;\n      break;\n    case mode.S_POLE:\n      y = -sinphi;\n      break;\n    case mode.N_POLE:\n      y = sinphi;\n      break;\n  }\n  y = this.pn1 / (this.p - y);\n  x = y * cosphi * Math.sin(p.x);\n\n  switch (this.mode) {\n    case mode.OBLIQ:\n      y *= this.cosph0 * sinphi - this.sinph0 * cosphi * coslam;\n      break;\n    case mode.EQUIT:\n      y *= sinphi;\n      break;\n    case mode.N_POLE:\n      y *= -(cosphi * coslam);\n      break;\n    case mode.S_POLE:\n      y *= cosphi * coslam;\n      break;\n  }\n\n  // Tilt \n  var yt, ba;\n  yt = y * this.cg + x * this.sg;\n  ba = 1 / (yt * this.sw * this.h1 + this.cw);\n  x = (x * this.cg - y * this.sg) * this.cw * ba;\n  y = yt * ba;\n\n  p.x = x * this.a;\n  p.y = y * this.a;\n  return p;\n}\n\nexport function inverse(p) {\n  p.x /= this.a;\n  p.y /= this.a;\n  var r = { x: p.x, y: p.y };\n\n  // Un-Tilt\n  var bm, bq, yt;\n  yt = 1 / (this.pn1 - p.y * this.sw);\n  bm = this.pn1 * p.x * yt;\n  bq = this.pn1 * p.y * this.cw * yt;\n  p.x = bm * this.cg + bq * this.sg;\n  p.y = bq * this.cg - bm * this.sg;\n\n  var rh = hypot(p.x, p.y);\n  if (Math.abs(rh) < EPSLN) {\n    r.x = 0;\n    r.y = p.y;\n  } else {\n    var cosz, sinz;\n    sinz = 1 - rh * rh * this.pfact;\n    sinz = (this.p - Math.sqrt(sinz)) / (this.pn1 / rh + rh / this.pn1);\n    cosz = Math.sqrt(1 - sinz * sinz);\n    switch (this.mode) {\n      case mode.OBLIQ:\n        r.y = Math.asin(cosz * this.sinph0 + p.y * sinz * this.cosph0 / rh);\n        p.y = (cosz - this.sinph0 * Math.sin(r.y)) * rh;\n        p.x *= sinz * this.cosph0;\n        break;\n      case mode.EQUIT:\n        r.y = Math.asin(p.y * sinz / rh);\n        p.y = cosz * rh;\n        p.x *= sinz;\n        break;\n      case mode.N_POLE:\n        r.y = Math.asin(cosz);\n        p.y = -p.y;\n        break;\n      case mode.S_POLE:\n        r.y = -Math.asin(cosz);\n        break;\n    }\n    r.x = Math.atan2(p.x, p.y);\n  }\n\n  p.x = r.x + this.long0;\n  p.y = r.y;\n  return p;\n}\n\nexport var names = [\"Tilted_Perspective\", \"tpers\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n"]},"metadata":{},"sourceType":"module"}