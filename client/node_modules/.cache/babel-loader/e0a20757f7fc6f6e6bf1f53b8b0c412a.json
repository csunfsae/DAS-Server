{"ast":null,"code":"// Robinson projection\n// Based on https://github.com/OSGeo/proj.4/blob/master/src/PJ_robin.c\n// Polynomial coeficients from http://article.gmane.org/gmane.comp.gis.proj-4.devel/6039\nimport { HALF_PI, D2R, R2D, EPSLN } from '../constants/values';\nimport adjust_lon from '../common/adjust_lon';\nvar COEFS_X = [[1.0000, 2.2199e-17, -7.15515e-05, 3.1103e-06], [0.9986, -0.000482243, -2.4897e-05, -1.3309e-06], [0.9954, -0.00083103, -4.48605e-05, -9.86701e-07], [0.9900, -0.00135364, -5.9661e-05, 3.6777e-06], [0.9822, -0.00167442, -4.49547e-06, -5.72411e-06], [0.9730, -0.00214868, -9.03571e-05, 1.8736e-08], [0.9600, -0.00305085, -9.00761e-05, 1.64917e-06], [0.9427, -0.00382792, -6.53386e-05, -2.6154e-06], [0.9216, -0.00467746, -0.00010457, 4.81243e-06], [0.8962, -0.00536223, -3.23831e-05, -5.43432e-06], [0.8679, -0.00609363, -0.000113898, 3.32484e-06], [0.8350, -0.00698325, -6.40253e-05, 9.34959e-07], [0.7986, -0.00755338, -5.00009e-05, 9.35324e-07], [0.7597, -0.00798324, -3.5971e-05, -2.27626e-06], [0.7186, -0.00851367, -7.01149e-05, -8.6303e-06], [0.6732, -0.00986209, -0.000199569, 1.91974e-05], [0.6213, -0.010418, 8.83923e-05, 6.24051e-06], [0.5722, -0.00906601, 0.000182, 6.24051e-06], [0.5322, -0.00677797, 0.000275608, 6.24051e-06]];\nvar COEFS_Y = [[-5.20417e-18, 0.0124, 1.21431e-18, -8.45284e-11], [0.0620, 0.0124, -1.26793e-09, 4.22642e-10], [0.1240, 0.0124, 5.07171e-09, -1.60604e-09], [0.1860, 0.0123999, -1.90189e-08, 6.00152e-09], [0.2480, 0.0124002, 7.10039e-08, -2.24e-08], [0.3100, 0.0123992, -2.64997e-07, 8.35986e-08], [0.3720, 0.0124029, 9.88983e-07, -3.11994e-07], [0.4340, 0.0123893, -3.69093e-06, -4.35621e-07], [0.4958, 0.0123198, -1.02252e-05, -3.45523e-07], [0.5571, 0.0121916, -1.54081e-05, -5.82288e-07], [0.6176, 0.0119938, -2.41424e-05, -5.25327e-07], [0.6769, 0.011713, -3.20223e-05, -5.16405e-07], [0.7346, 0.0113541, -3.97684e-05, -6.09052e-07], [0.7903, 0.0109107, -4.89042e-05, -1.04739e-06], [0.8435, 0.0103431, -6.4615e-05, -1.40374e-09], [0.8936, 0.00969686, -6.4636e-05, -8.547e-06], [0.9394, 0.00840947, -0.000192841, -4.2106e-06], [0.9761, 0.00616527, -0.000256, -4.2106e-06], [1.0000, 0.00328947, -0.000319159, -4.2106e-06]];\nvar FXC = 0.8487;\nvar FYC = 1.3523;\nvar C1 = R2D / 5; // rad to 5-degree interval\n\nvar RC1 = 1 / C1;\nvar NODES = 18;\n\nvar poly3_val = function poly3_val(coefs, x) {\n  return coefs[0] + x * (coefs[1] + x * (coefs[2] + x * coefs[3]));\n};\n\nvar poly3_der = function poly3_der(coefs, x) {\n  return coefs[1] + x * (2 * coefs[2] + x * 3 * coefs[3]);\n};\n\nfunction newton_rapshon(f_df, start, max_err, iters) {\n  var x = start;\n\n  for (; iters; --iters) {\n    var upd = f_df(x);\n    x -= upd;\n\n    if (Math.abs(upd) < max_err) {\n      break;\n    }\n  }\n\n  return x;\n}\n\nexport function init() {\n  this.x0 = this.x0 || 0;\n  this.y0 = this.y0 || 0;\n  this.long0 = this.long0 || 0;\n  this.es = 0;\n  this.title = this.title || \"Robinson\";\n}\nexport function forward(ll) {\n  var lon = adjust_lon(ll.x - this.long0);\n  var dphi = Math.abs(ll.y);\n  var i = Math.floor(dphi * C1);\n\n  if (i < 0) {\n    i = 0;\n  } else if (i >= NODES) {\n    i = NODES - 1;\n  }\n\n  dphi = R2D * (dphi - RC1 * i);\n  var xy = {\n    x: poly3_val(COEFS_X[i], dphi) * lon,\n    y: poly3_val(COEFS_Y[i], dphi)\n  };\n\n  if (ll.y < 0) {\n    xy.y = -xy.y;\n  }\n\n  xy.x = xy.x * this.a * FXC + this.x0;\n  xy.y = xy.y * this.a * FYC + this.y0;\n  return xy;\n}\nexport function inverse(xy) {\n  var ll = {\n    x: (xy.x - this.x0) / (this.a * FXC),\n    y: Math.abs(xy.y - this.y0) / (this.a * FYC)\n  };\n\n  if (ll.y >= 1) {\n    // pathologic case\n    ll.x /= COEFS_X[NODES][0];\n    ll.y = xy.y < 0 ? -HALF_PI : HALF_PI;\n  } else {\n    // find table interval\n    var i = Math.floor(ll.y * NODES);\n\n    if (i < 0) {\n      i = 0;\n    } else if (i >= NODES) {\n      i = NODES - 1;\n    }\n\n    for (;;) {\n      if (COEFS_Y[i][0] > ll.y) {\n        --i;\n      } else if (COEFS_Y[i + 1][0] <= ll.y) {\n        ++i;\n      } else {\n        break;\n      }\n    } // linear interpolation in 5 degree interval\n\n\n    var coefs = COEFS_Y[i];\n    var t = 5 * (ll.y - coefs[0]) / (COEFS_Y[i + 1][0] - coefs[0]); // find t so that poly3_val(coefs, t) = ll.y\n\n    t = newton_rapshon(function (x) {\n      return (poly3_val(coefs, x) - ll.y) / poly3_der(coefs, x);\n    }, t, EPSLN, 100);\n    ll.x /= poly3_val(COEFS_X[i], t);\n    ll.y = (5 * i + t) * D2R;\n\n    if (xy.y < 0) {\n      ll.y = -ll.y;\n    }\n  }\n\n  ll.x = adjust_lon(ll.x + this.long0);\n  return ll;\n}\nexport var names = [\"Robinson\", \"robin\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};","map":{"version":3,"sources":["C:/Users/brand/source/repos/DAS-Server/client/node_modules/proj4/lib/projections/robin.js"],"names":["HALF_PI","D2R","R2D","EPSLN","adjust_lon","COEFS_X","COEFS_Y","FXC","FYC","C1","RC1","NODES","poly3_val","coefs","x","poly3_der","newton_rapshon","f_df","start","max_err","iters","upd","Math","abs","init","x0","y0","long0","es","title","forward","ll","lon","dphi","y","i","floor","xy","a","inverse","t","names"],"mappings":"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","sourcesContent":["// Robinson projection\n// Based on https://github.com/OSGeo/proj.4/blob/master/src/PJ_robin.c\n// Polynomial coeficients from http://article.gmane.org/gmane.comp.gis.proj-4.devel/6039\n\nimport {HALF_PI, D2R, R2D, EPSLN} from '../constants/values';\nimport adjust_lon from '../common/adjust_lon';\n\nvar COEFS_X = [\n    [1.0000, 2.2199e-17, -7.15515e-05, 3.1103e-06],\n    [0.9986, -0.000482243, -2.4897e-05, -1.3309e-06],\n    [0.9954, -0.00083103, -4.48605e-05, -9.86701e-07],\n    [0.9900, -0.00135364, -5.9661e-05, 3.6777e-06],\n    [0.9822, -0.00167442, -4.49547e-06, -5.72411e-06],\n    [0.9730, -0.00214868, -9.03571e-05, 1.8736e-08],\n    [0.9600, -0.00305085, -9.00761e-05, 1.64917e-06],\n    [0.9427, -0.00382792, -6.53386e-05, -2.6154e-06],\n    [0.9216, -0.00467746, -0.00010457, 4.81243e-06],\n    [0.8962, -0.00536223, -3.23831e-05, -5.43432e-06],\n    [0.8679, -0.00609363, -0.000113898, 3.32484e-06],\n    [0.8350, -0.00698325, -6.40253e-05, 9.34959e-07],\n    [0.7986, -0.00755338, -5.00009e-05, 9.35324e-07],\n    [0.7597, -0.00798324, -3.5971e-05, -2.27626e-06],\n    [0.7186, -0.00851367, -7.01149e-05, -8.6303e-06],\n    [0.6732, -0.00986209, -0.000199569, 1.91974e-05],\n    [0.6213, -0.010418, 8.83923e-05, 6.24051e-06],\n    [0.5722, -0.00906601, 0.000182, 6.24051e-06],\n    [0.5322, -0.00677797, 0.000275608, 6.24051e-06]\n];\n\nvar COEFS_Y = [\n    [-5.20417e-18, 0.0124, 1.21431e-18, -8.45284e-11],\n    [0.0620, 0.0124, -1.26793e-09, 4.22642e-10],\n    [0.1240, 0.0124, 5.07171e-09, -1.60604e-09],\n    [0.1860, 0.0123999, -1.90189e-08, 6.00152e-09],\n    [0.2480, 0.0124002, 7.10039e-08, -2.24e-08],\n    [0.3100, 0.0123992, -2.64997e-07, 8.35986e-08],\n    [0.3720, 0.0124029, 9.88983e-07, -3.11994e-07],\n    [0.4340, 0.0123893, -3.69093e-06, -4.35621e-07],\n    [0.4958, 0.0123198, -1.02252e-05, -3.45523e-07],\n    [0.5571, 0.0121916, -1.54081e-05, -5.82288e-07],\n    [0.6176, 0.0119938, -2.41424e-05, -5.25327e-07],\n    [0.6769, 0.011713, -3.20223e-05, -5.16405e-07],\n    [0.7346, 0.0113541, -3.97684e-05, -6.09052e-07],\n    [0.7903, 0.0109107, -4.89042e-05, -1.04739e-06],\n    [0.8435, 0.0103431, -6.4615e-05, -1.40374e-09],\n    [0.8936, 0.00969686, -6.4636e-05, -8.547e-06],\n    [0.9394, 0.00840947, -0.000192841, -4.2106e-06],\n    [0.9761, 0.00616527, -0.000256, -4.2106e-06],\n    [1.0000, 0.00328947, -0.000319159, -4.2106e-06]\n];\n\nvar FXC = 0.8487;\nvar FYC = 1.3523;\nvar C1 = R2D/5; // rad to 5-degree interval\nvar RC1 = 1/C1;\nvar NODES = 18;\n\nvar poly3_val = function(coefs, x) {\n    return coefs[0] + x * (coefs[1] + x * (coefs[2] + x * coefs[3]));\n};\n\nvar poly3_der = function(coefs, x) {\n    return coefs[1] + x * (2 * coefs[2] + x * 3 * coefs[3]);\n};\n\nfunction newton_rapshon(f_df, start, max_err, iters) {\n    var x = start;\n    for (; iters; --iters) {\n        var upd = f_df(x);\n        x -= upd;\n        if (Math.abs(upd) < max_err) {\n            break;\n        }\n    }\n    return x;\n}\n\nexport function init() {\n    this.x0 = this.x0 || 0;\n    this.y0 = this.y0 || 0;\n    this.long0 = this.long0 || 0;\n    this.es = 0;\n    this.title = this.title || \"Robinson\";\n}\n\nexport function forward(ll) {\n    var lon = adjust_lon(ll.x - this.long0);\n\n    var dphi = Math.abs(ll.y);\n    var i = Math.floor(dphi * C1);\n    if (i < 0) {\n        i = 0;\n    } else if (i >= NODES) {\n        i = NODES - 1;\n    }\n    dphi = R2D * (dphi - RC1 * i);\n    var xy = {\n        x: poly3_val(COEFS_X[i], dphi) * lon,\n        y: poly3_val(COEFS_Y[i], dphi)\n    };\n    if (ll.y < 0) {\n        xy.y = -xy.y;\n    }\n\n    xy.x = xy.x * this.a * FXC + this.x0;\n    xy.y = xy.y * this.a * FYC + this.y0;\n    return xy;\n}\n\nexport function inverse(xy) {\n    var ll = {\n        x: (xy.x - this.x0) / (this.a * FXC),\n        y: Math.abs(xy.y - this.y0) / (this.a * FYC)\n    };\n\n    if (ll.y >= 1) { // pathologic case\n        ll.x /= COEFS_X[NODES][0];\n        ll.y = xy.y < 0 ? -HALF_PI : HALF_PI;\n    } else {\n        // find table interval\n        var i = Math.floor(ll.y * NODES);\n        if (i < 0) {\n            i = 0;\n        } else if (i >= NODES) {\n            i = NODES - 1;\n        }\n        for (;;) {\n            if (COEFS_Y[i][0] > ll.y) {\n                --i;\n            } else if (COEFS_Y[i+1][0] <= ll.y) {\n                ++i;\n            } else {\n                break;\n            }\n        }\n        // linear interpolation in 5 degree interval\n        var coefs = COEFS_Y[i];\n        var t = 5 * (ll.y - coefs[0]) / (COEFS_Y[i+1][0] - coefs[0]);\n        // find t so that poly3_val(coefs, t) = ll.y\n        t = newton_rapshon(function(x) {\n            return (poly3_val(coefs, x) - ll.y) / poly3_der(coefs, x);\n        }, t, EPSLN, 100);\n\n        ll.x /= poly3_val(COEFS_X[i], t);\n        ll.y = (5 * i + t) * D2R;\n        if (xy.y < 0) {\n            ll.y = -ll.y;\n        }\n    }\n\n    ll.x = adjust_lon(ll.x + this.long0);\n    return ll;\n}\n\nexport var names = [\"Robinson\", \"robin\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n"]},"metadata":{},"sourceType":"module"}